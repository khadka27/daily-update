name: ðŸ“… Daily Commit

permissions:
  contents: write
  actions: read

on:
  schedule:
    - cron: "15 18 * * *" # 18:15 UTC â†’ 00:00 NPT
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
          persist-credentials: true

      - name: Fix remote origin
        run: |
          git remote set-url origin https://${{ secrets.GITHUB_TOKEN }}@github.com/khadka27/daily-update.git

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install ts-node
        run: npm install -g ts-node typescript

      - name: Configure Git user
        run: |
          git config user.name "khadka27"
          git config user.email "abishekkhadka90@gmail.com"

      - name: Generate and commit journal entry
        run: |
          #!/usr/bin/env bash
          cat > generate_content.ts << 'EOF'
          import { writeFileSync, mkdirSync, existsSync } from 'fs';
          const quotes = [ /* â€¦your quotes arrayâ€¦ */ ];
          const topics = [ /* â€¦your topics arrayâ€¦ */ ];
          const goals  = [ /* â€¦your goals arrayâ€¦ */ ];

          function sample<T>(arr: T[], n: number): T[] { /* â€¦ */ }

          function main() {
            const dateStr = new Date().toISOString().split('T')[0];
            /* â€¦build your markdownâ€¦ */
            const dir = 'journals';
            if (!existsSync(dir)) mkdirSync(dir);
            writeFileSync(`${dir}/journal-${dateStr}.md`, md);
          }
          main();
          EOF

          ts-node generate_content.ts

          CURRENT_DATE=$(date -u +'%Y-%m-%d')
          git add journals/journal-"$CURRENT_DATE".md
          git commit -m "feat: add journal entry for $CURRENT_DATE" || \
            git commit --allow-empty -m "chore: daily automated commit $CURRENT_DATE"

      - name: Push changes
        run: git push origin main
